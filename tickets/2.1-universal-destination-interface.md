# Ticket 2.1: Universal Destination Interface

## ğŸ“‹ Ticket Details
**Phase**: 2 - Universal Destinations  
**Story Points**: 2  
**Priority**: High  
**Assignee**: TBD  
**Status**: Ready

## ğŸ”— Dependencies
**Depends on**: Phase 1 Complete  
**Blocking**: Ticket 2.2 (Scripts Endpoint), Ticket 2.3 (Meta Pixel), Ticket 2.4 (Google Analytics)  

## ğŸ¯ Description
Extend DestinationPlugin to support client-side scripts. This ticket creates the foundation for universal destinations that can generate both server-side event handlers and client-side JavaScript scripts.

## ğŸ§  Context & Background
Universal destinations are a key innovation that allows one configuration to control both:
- **Server-side**: Event processing and API calls
- **Client-side**: JavaScript scripts loaded in the browser

This eliminates duplicate configuration and ensures consistency between server and client tracking. The interface must:
- Extend the existing DestinationPlugin interface
- Add script generation capabilities
- Support different script types (inline, external, async)
- Handle consent-based script loading
- Maintain backward compatibility

## âœ… Acceptance Criteria
- [ ] Create `UniversalDestinationPlugin` interface
- [ ] Add `generateScript` method signature
- [ ] Create `Script` type for script definitions
- [ ] Update existing destinations to implement new interface
- [ ] Add backward compatibility
- [ ] Unit tests for new interface

## ğŸ“ Files to Update
- `packages/backend/src/v2/handlers/analytics/core-types.ts` (extend existing interface)

## ğŸ” Definition of Done
- [ ] UniversalDestinationPlugin interface defined
- [ ] Script type defined with proper structure
- [ ] Existing destinations updated to implement interface
- [ ] Backward compatibility maintained
- [ ] Unit tests for new interface
- [ ] Code review completed

## ğŸ§ª Testing Requirements
- Unit tests for UniversalDestinationPlugin interface
- Unit tests for Script type
- Compatibility tests for existing destinations

## ğŸ“š Related Documentation
- [Universal Destinations](../docs/analytics-universal-destinations.md)
- [Analytics Package Architecture](../docs/analytics-package-architecture.md)

## ğŸ”— Dependencies
- Phase 1 Complete âœ…

## ğŸš€ Next Ticket
[2.2: Scripts Endpoint](./08-scripts-endpoint.md)
